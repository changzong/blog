---
layout: post
title: "Hive远程数据库命令行执行配置"
date: 2016-05-18 08:28:00
categories: jekyll update
---
### 目的

能够实现在本地hive成功运行的同时能访问远程服务器端的原数据文件，从而可以执行查询语句。

### 步骤

* 本地Hive配置：

下载Hive文件至本地路径，在环境变量中添加HIVE_HOME，并在PATH中添加HIVE_HOME/bin.

* 启动错误：

在第一次启动hive时可能会出现无法初始化metastore错误，这时需要使用schema tool来初始化

```
mv metastore_db metastore_db.tmp
schematool -initSchema -dbType derby
```

* 配置远程服务器连接：

新建hive-site.xml文件，复制一下内容：

```
<?xml version="1.0" encoding="UTF-8"?>
<!--Autogenerated by Cloudera Manager-->
<configuration>
  <property>
    <name>hive.metastore.uris</name>
    <value>thrift://big-bigWorker-6.100.idc.tf56:9083</value>
  </property>
  <property>
    <name>hive.metastore.client.socket.timeout</name>
    <value>300</value>
  </property>
  <property>
    <name>hive.metastore.warehouse.dir</name>
    <value>/user/hive/warehouse</value>
  </property>
  <property>
    <name>hive.warehouse.subdir.inherit.perms</name>
    <value>true</value>
  </property>
  <property>
    <name>hive.enable.spark.execution.engine</name>
    <value>false</value>
  </property>
  <property>
    <name>hive.conf.restricted.list</name>
    <value>hive.enable.spark.execution.engine</value>
  </property>
  <property>
    <name>mapred.reduce.tasks</name>
    <value>-1</value>
  </property>
  <property>
    <name>hive.exec.reducers.bytes.per.reducer</name>
    <value>67108864</value>
  </property>
  <property>
    <name>hive.exec.copyfile.maxsize</name>
    <value>33554432</value>
  </property>
  <property>
    <name>hive.exec.reducers.max</name>
    <value>1099</value>
  </property>
  <property>
    <name>hive.metastore.execute.setugi</name>
    <value>true</value>
  </property>
  <property>
    <name>hive.support.concurrency</name>
    <value>true</value>
  </property>
  <property>
    <name>hive.zookeeper.quorum</name>
    <value>big-bigWorker-1.100.idc.tf56,big-bigMaster-2.100.idc.tf56,big-bigWorker-2.100.idc.tf56,big-bigWorker-3.100.idc.tf56,big-bigMaster-1.100.idc.tf56</value>
  </property>
  <property>
    <name>hive.zookeeper.client.port</name>
    <value>2181</value>
  </property>
  <property>
    <name>hbase.zookeeper.quorum</name>
    <value>big-bigWorker-1.100.idc.tf56,big-bigMaster-2.100.idc.tf56,big-bigWorker-2.100.idc.tf56,big-bigWorker-3.100.idc.tf56,big-bigMaster-1.100.idc.tf56</value>
  </property>
  <property>
    <name>hbase.zookeeper.property.clientPort</name>
    <value>2181</value>
  </property>
  <property>
    <name>hive.zookeeper.namespace</name>
    <value>hive_zookeeper_namespace_hive</value>
  </property>
  <property>
    <name>hive.cluster.delegation.token.store.class</name>
    <value>org.apache.hadoop.hive.thrift.MemoryTokenStore</value>
  </property>
  <property>
    <name>hive.server2.enable.doAs</name>
    <value>true</value>
  </property>
  <property>
    <name>hive.server2.use.SSL</name>
    <value>false</value>
  </property>
</configuration>
```
其中关键配置在于 hive.metastore.uris 和 hive.metastore.warehouse.dir，以及 hive.zookeeper.quorum，用以识别服务器地址的相对文件路径。

* 配置hosts

打开/etc/hosts，将hive.zookeeper.quorum中的各个节点名称及对应ip地址添加进去：

```
10.33.88.15     bigworker-1 big-bigWorker-1.100.idc.tf56 big-bigworker-1.100.idc.tf56
10.33.88.16     bigworker-2 big-bigworker-2.100.idc.tf56
10.33.88.17     bigworker-3 big-bigworker-3.100.idc.tf56
10.33.88.18     bigworker-4 big-bigworker-4.100.idc.tf56
10.33.88.19     bigworker-5 big-bigworker-5.100.idc.tf56
10.33.88.20     bigworker-6 big-bigworker-6.100.idc.tf56
10.33.88.11     big-bigmaster-1.100.idc.tf56
10.33.88.12     big-bigMaster-2.100.idc.tf56
```

* 拷贝json-serde-1.3.7-SNAPSHOT-jar-with-dependencies.jar文件：

及将查询时所需要的格式文件json-serde-1.3.7-SNAPSHOT-jar-with-dependencies.jar从服务器上拷贝到本地的HIVE_HOME/lib中

